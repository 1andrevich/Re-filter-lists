name: Manual PR From sum/input

on:
  workflow_dispatch:

jobs:
  create_pr:
    runs-on: self-hosted
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: main
          path: repo
          persist-credentials: true
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Ensure GitHub token is used for git operations
        run: |
          git config --global url."https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/".insteadOf "https://github.com/"

      - name: Copy input files into repo
        run: |
          SRC_DIR=/home/github/actions-runner/_work/Re-filter-lists/Re-filter-lists/sum/input
          test -f "${SRC_DIR}/domains.lst"
          test -f "${SRC_DIR}/ip.lst"
          mkdir -p repo/sum/input
          cp "${SRC_DIR}/domains.lst" repo/sum/input/domains.lst
          cp "${SRC_DIR}/ip.lst" repo/sum/input/ip.lst

      - name: Set PR date
        run: |
          DATE_TAG=$(date +%d%m%Y)
          DATE_TITLE=$(date +%d-%m-%Y)
          echo "DATE_TAG=${DATE_TAG}" >> $GITHUB_ENV
          echo "DATE_TITLE=${DATE_TITLE}" >> $GITHUB_ENV

      - name: Create PR to main with outputs
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          base: main
          branch: auto-build-${{ env.DATE_TAG }}
          commit-message: "Update domains.lst and ip.lst"
          title: "Update outputs ${{ env.DATE_TITLE }}"
          body: "Automated update of domains.lst and ip.lst."
          add-paths: |
            sum/input/domains.lst
            sum/input/ip.lst
          path: repo
